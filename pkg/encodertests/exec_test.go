package encodertests

import (
	"bytes"
	"encoding/binary"
	"testing"

	"github.com/cilium/tetragon/pkg/api/processapi"
	"github.com/stretchr/testify/assert"
)

var arr []byte = []byte{5, 0, 0, 0, 99, 1, 0, 0, 236, 131, 186, 39, 30, 80, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 42, 63, 0, 0, 0, 0, 0, 0, 115, 101, 115, 115, 105, 111, 110, 45, 49, 48, 52, 46, 115, 99, 111, 112, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 35, 206, 54, 0, 0, 0, 0, 0, 19, 201, 167, 37, 30, 80, 1, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 254, 255, 255, 239, 255, 255, 255, 239, 1, 0, 0, 240, 252, 255, 255, 239, 252, 255, 255, 239, 0, 0, 0, 240, 250, 255, 255, 239, 250, 255, 255, 239, 251, 255, 255, 239, 253, 255, 255, 239, 44, 206, 54, 0, 0, 0, 0, 0, 172, 83, 136, 39, 30, 80, 1, 0, 91, 0, 0, 0, 44, 206, 54, 0, 44, 206, 54, 0, 0, 0, 0, 0, 0, 0, 0, 0, 232, 3, 0, 0, 232, 3, 0, 0, 1, 64, 0, 1, 236, 131, 186, 39, 30, 80, 1, 0, 47, 117, 115, 114, 47, 98, 105, 110, 47, 101, 99, 104, 111, 0, 0, 0, 0, 0, 0, 0, 0, 0, 44, 206, 54, 0, 44, 206, 54, 0, 75, 138, 186, 39, 30, 80, 1, 0, 47, 104, 111, 109, 101, 47, 110, 117, 116, 97, 110, 105, 120, 103}

func TestEncoderIndexOutOfRange(t *testing.T) {
	r := bytes.NewReader(arr)
	m := processapi.MsgExecveEvent{}
	err := binary.Read(r, binary.LittleEndian, &m)
	assert.NoError(t, err)
}
